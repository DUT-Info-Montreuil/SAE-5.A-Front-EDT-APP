<form [formGroup]="mainForm" (ngSubmit)="onSubmit()">
  <ng-container *ngIf="userFormArray">
    <div formArrayName="users">
      <div *ngFor="let userGroup of userFormArray.controls; let i = index">
        <div [formGroupName]="i">
          <!-- ... Vos champs de formulaire ... -->
          <label for="first-name"><b>Prénom : </b></label>
          <input type="text" id="first-name" formControlName="firstName" />
  
          <label for="last-name"><b>Nom : </b></label>
          <input type="text" id="last-name" formControlName="lastName" />
          <ng-container *ngIf="userGroup.get('role') && userGroup.get('info')">
            <select id="role" formControlName="role" (change)="onRoleChange(i)">
              <option value="" disabled selected>--Choisir un rôle--</option>
              <option value="admin">Administrateur</option>
              <option value="professeur">Professeur</option>
              <option value="eleve">Elève</option>
            </select>

            <div formGroupName="info">
              <div *ngIf="userGroup.get('role')!.value === 'eleve' && userGroup.get('info')!.get('idGroupe')">
                <select id="idGroupe" formControlName="idGroupe">
                  <option value="" disabled selected>--Choisir un groupe--</option>
                  <option value="1">A1</option>
                  <option value="2">A2</option>
                  <option value="3">B1</option>
                  <option value="4">B2</option>
                  <option value="5">C1</option>
                  <option value="6">C2</option>
              </select>
              </div>
              <div *ngIf="userGroup.get('role')!.value === 'professeur' && userGroup.get('info')!.get('idSalle')">
                <select id="idSalle" formControlName="idSalle">
                  <option value="" disabled selected>--Choisir une salle--</option>
                  <option value="1">Salle 1</option>
                  <option value="2">Salle 2</option>
                  <option value="3">Salle 3</option>
                  <option value="4">Salle 4</option>
                  <option value="5">Salle 5</option>
                  <option value="6">Salle 6</option>
                </select>
                <label for="isManager"><b>Manager : </b></label>
                <input type="checkbox" id="isManager" formControlName="isManager" />
              </div>

              <ng-container *ngIf="i !== 0">
                <button type="button" (click)="removeUser(i)">Supprimer l'utilisateur</button>
              </ng-container>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
  </ng-container>

  <button type="button" (click)="addUser()">Ajouter un utilisateur</button>

  <p> {{ mainForm.value | json }} </p>
  <button type="submit" [disabled]="!mainForm.valid">Créer</button>
</form>


