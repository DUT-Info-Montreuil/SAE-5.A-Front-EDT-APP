<form [formGroup]="mainForm" (ngSubmit)="onSubmit()">
  <ng-container *ngIf="userFormArray">
    <table>
      <thead>
        <tr>
          <th>Prénom</th>
          <th>Nom</th>
          <th>Rôle</th>
          <th>Options</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody formArrayName="users">
        <tr *ngFor="let userGroup of userFormArray.controls; let i = index" [formGroupName]="i">
          <td>
            <label for="first-name"><b>Prénom : </b></label>
            <input type="text" id="first-name" formControlName="firstName" />
          </td>
          <td>
            <label for="last-name"><b>Nom : </b></label>
            <input type="text" id="last-name" formControlName="lastName" />
          </td>
          <td>
            <select id="role" formControlName="role" (change)="onRoleChange(i)">
              <option value="" disabled selected>--Choisir un rôle--</option>
              <option value="admin">Administrateur</option>
              <option value="professeur">Professeur</option>
              <option value="eleve">Elève</option>
            </select>
          </td>
          <td>
            <ng-container *ngIf="userGroup.get('role')">
              <div *ngIf="userGroup.get('role')!.value === 'eleve'">
                <select id="idGroupe" formControlName="idGroupe">
                  <option value="" disabled selected hidden>--Choisir un groupe--</option>
                  <option value="1">A1</option>
                  <option value="2">A2</option>
                  <option value="3">B1</option>
                  <option value="4">B2</option>
                  <option value="5">C1</option>
                  <option value="6">C2</option>
                </select>
              </div>
              <div *ngIf="userGroup.get('role')!.value === 'professeur'">
                <label for="idSalle"><b>Salle : </b></label>
                <select id="idSalle" formControlName="idSalle">
                  <option value="" disabled selected>--Choisir une salle--</option>
                  <option value="1">Salle 1</option>
                  <option value="2">Salle 2</option>
                  <option value="3">Salle 3</option>
                  <option value="4">Salle 4</option>
                  <option value="5">Salle 5</option>
                  <option value="6">Salle 6</option>
                </select>
                <label for="isManager"><b>Manager : </b></label>
                <input type="checkbox" id="isManager" formControlName="isManager" />
              </div>
            </ng-container>
          </td>
          <td>
            <!-- Bouton de suppression pour chaque utilisateur sauf le premier -->
            <ng-container *ngIf="i !== 0">
              <button type="button" (click)="removeUser(i)">Supprimer l'utilisateur</button>
            </ng-container>
          </td>
        </tr>
      </tbody>
    </table>
  </ng-container>

  <button type="button" (click)="addUser()">Ajouter un utilisateur</button>

  <p> {{ mainForm.value | json }} </p>
  <button type="submit" [disabled]="!mainForm.valid">Créer</button>
</form>
